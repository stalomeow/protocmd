# protocmd

This project provides an easy way to manage a mapping between uint16 ids (a.k.a. CmdId/MsgId) and protobuf Messages.

Currently, only support Go and C# (Unity).

This project is comprised of two components:

- Runtime library for Go: This provides the ability to create a protobuf Message using a predefined uint16 id.

- Code generator: The `protoc-gen-cmd` tool is a compiler plugin to protoc, the protocol buffer compiler. It generates code that maps ids to messages, vice versa.

The runtime library for C# (Unity) is [github.com/stalomeow/Protobuf-Unity](https://github.com/stalomeow/Protobuf-Unity).

## Runtime Usage

### Go

Import `"github.com/stalomeow/protocmd"`.

``` go
package main

import (
	"fmt"
	"github.com/stalomeow/protocmd"
	"github.com/stalomeow/protocmd/examples/go/protos" // load all protos
)

func main() {
	// Create cmd by id
	msg, err := protocmd.NewMessageByCmdId(protos.TestReq_CmdId)
	if err != nil {
		fmt.Printf("Error %v", err)
		return
	}

	// Get cmd id and name
	fmt.Printf("Cmd (id: %v, name: %s)\n", msg.CmdId(), msg.CmdName())

	req := msg.(*protos.TestReq)
	req.Uid = "123321"
	fmt.Println(req)
}
```

### C# (Unity)

``` c#
using Examples.CSharp.Protos;
using Examples.CSharp;
using Google.Protobuf;
using UnityEngine;

public class Example : MonoBehaviour
{
    // MessageHelpers is generated by protoc-gen-cmd
    public static MessageHelpers Helpers = new();

    private void Start()
    {
        byte[] bytes = new TestReq() { Uid = "123321" }.ToByteArray();

        MessageParser parser = Helpers.GetMessageParserByCmdId(TestReq.CmdId);
        ICmdMessage msg = parser.ParseFrom(bytes) as ICmdMessage;

        print(msg.CmdId);
        print(msg.CmdName);
        print((TestReq)msg);
    }
}
```

## protoc-gen-cmd

```
go install github.com/stalomeow/protocmd/protoc-gen-cmd
```

### Go

### C#
